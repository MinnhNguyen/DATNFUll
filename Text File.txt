---FE
ZaloPay Response:
Object { return_code: 1, return_message: "Giao dá»‹ch thÃ nh cÃ´ng", sub_return_code: 1, sub_return_message: "Giao dá»‹ch thÃ nh cÃ´ng", zp_trans_token: "ACEyueEccqD_cJhYK5jW0AlA", order_url: "https://qcgateway.zalopay.vn/openinapp?order=eyJ6cHRyYW5zdG9rZW4iOiJBQ0V5dWVFY2NxRF9jSmhZSzVqVzBBbEEiLCJhcHBpZCI6MjU1NH0=", order_token: "ACEyueEccqD_cJhYK5jW0AlA", app_trans_id: "260110_1768006152248" }
thanhToan.js:41:17
ğŸ”² [ZALOPAY] Generating QR code ThanhToanDonHang-BanHang.vue:1162:13
ğŸ› [DEBUG] Before polling start ThanhToanDonHang-BanHang.vue:1182:13
ğŸ”„ [ZALOPAY] Starting payment polling ThanhToanDonHang-BanHang.vue:1185:13
ğŸ”„ Starting payment polling for ZaloPay: 4091 paymentPollingService.js:50:15
âœ… Polling started for 4091 paymentPollingService.js:91:15
âœ… [ZALOPAY] Payment flow initiated successfully ThanhToanDonHang-BanHang.vue:1191:13
ğŸ”„ Polling attempt 1/40 for 4091 paymentPollingService.js:119:15
ğŸ”„ Polling attempt 2/40 for 4091 paymentPollingService.js:119:15
â³ Payment 4091 still pending... 2 paymentPollingService.js:192:15
ğŸ”„ Polling attempt 3/40 for 4091 paymentPollingService.js:119:15
ğŸ”„ Polling attempt 4/40 for 4091 paymentPollingService.js:119:15
âœ… Payment success: 4091
Object { return_code: 1, return_message: "Giao dá»‹ch thÃ nh cÃ´ng", sub_return_code: 1, sub_return_message: "Giao dá»‹ch thÃ nh cÃ´ng", is_processing: false, amount: 342000, zp_trans_id: 260110000000130, server_time: 1768006181685, discount_amount: 0 }
paymentPollingService.js:209:15
âœ… Payment success: 4091
Object { return_code: 1, return_message: "Giao dá»‹ch thÃ nh cÃ´ng", sub_return_code: 1, sub_return_message: "Giao dá»‹ch thÃ nh cÃ´ng", is_processing: false, amount: 342000, zp_trans_id: 260110000000130, server_time: 1768006181685, discount_amount: 0 }
paymentPollingService.js:209:15
ğŸ’³ Payment status updated: pending â†’ success <empty string> paymentState.js:97:13
âœ… Payment state cleared invoiceStorage.js:155:15
âœ… [ZALOPAY] Payment successful ThanhToanDonHang-BanHang.vue:1208:11
ğŸ“ [ZALOPAY] Confirming order 4091 (First call: true) ThanhToanDonHang-BanHang.vue:1215:13
ğŸ›‘ Stopping polling for 4091 paymentPollingService.js:289:15
âœ… Polling stopped for 4091 paymentPollingService.js:312:15
ğŸ’³ Payment status updated: success â†’ success <empty string> paymentState.js:97:13
âœ… Payment state cleared invoiceStorage.js:155:15
âœ… [ZALOPAY] Payment successful ThanhToanDonHang-BanHang.vue:1208:11
ğŸ“ [ZALOPAY] Confirming order 4091 (First call: false) ThanhToanDonHang-BanHang.vue:1215:13
ğŸ›‘ Stopping polling for 4091 paymentPollingService.js:289:15
âœ… Polling stopped for 4091 paymentPollingService.js:312:15
âœ… [ZALOPAY] Order confirmed (isChuyen: false) ThanhToanDonHang-BanHang.vue:1233:13
âœ… [ZALOPAY] Order confirmed (isChuyen: true) ThanhToanDonHang-BanHang.vue:1233:13
Window focused - checking product quantities GioHang.vue:1294:17
ğŸš€ [STOCK UPDATE] Starting batch update for 1 items GioHang.vue:1121:17
Window focused - checking product quantities GioHang.vue:1294:17
â­ï¸ [STOCK UPDATE] Cart is empty, skipping update GioHang.vue:1116:17
Window focused - checking product quantities GioHang.vue:1294:17
ğŸš€ [STOCK UPDATE] Starting batch update for 1 items GioHang.vue:1121:17
ğŸ“Š [BATCH STOCK] Cache: 0 hits, 1 misses batchStockService.js:128:13
ğŸš€ [BATCH API] Fetching stock for 1 products batchStockService.js:137:17
ğŸ“Š [BATCH STOCK] Cache: 0 hits, 1 misses batchStockService.js:128:13
ğŸš€ [BATCH API] Fetching stock for 1 products batchStockService.js:137:17
XHRPOST
http://localhost:8080/gioHangWeb/batchCheckStock
[HTTP/1.1 404  7ms]

XHRPOST
http://localhost:8080/gioHangWeb/batchCheckStock
[HTTP/1.1 404  6ms]

âš ï¸ [BATCH API] Endpoint not found, falling back to parallel calls batchStockService.js:154:21
ğŸ”„ [FALLBACK] Fetching 1 products in parallel batchStockService.js:160:17
âš ï¸ [BATCH API] Endpoint not found, falling back to parallel calls batchStockService.js:154:21
ğŸ”„ [FALLBACK] Fetching 1 products in parallel batchStockService.js:160:17
âœ… [STOCK UPDATE] Received batch data for 1 products GioHang.vue:1137:17
ğŸ“Š [STOCK] Ão thun Cotton: max=46, status=Hoáº¡t Ä‘á»™ng GioHang.vue:1160:21
â„¹ï¸ [STOCK UPDATE] No adjustments needed, all quantities within limits GioHang.vue:1221:21
âœ… [STOCK UPDATE] Received batch data for 1 products GioHang.vue:1137:17
ğŸ“Š [STOCK] Ão thun Cotton: max=46, status=Hoáº¡t Ä‘á»™ng GioHang.vue:1160:21
â„¹ï¸ [STOCK UPDATE] No adjustments needed, all quantities within limits GioHang.vue:1221:21
Dá»¯ liá»‡u sáº£n pháº©m má»›i Ä‘Ã£ chuyá»ƒn Ä‘á»•i:
Proxy { <target>: (4) [â€¦], <handler>: {â€¦} }
AoTheThaoBanChay.vue:191:17
[Vue warn]: Failed to resolve component: print-invoice
If this is a native custom element, make sure to exclude it from component resolution via compilerOptions.isCustomElement.
  at <TraCuuDonHang>
  at <TraCuuDonHangBanHang onVnodeUnmounted=fn<onVnodeUnmounted> ref=Ref< null > >
  at <RouterView>
  at <Home onVnodeUnmounted=fn<onVnodeUnmounted> ref=Ref<
Proxy { <target>: {â€¦}, <handler>: {â€¦} }
 > >
  at <RouterView>
  at <App> runtime-core.esm-bundler.js:51:13
Lá»—i API tÃ­nh phÃ­ ship:
Object { message: "Request failed with status code 400", name: "AxiosError", code: "ERR_BAD_REQUEST", config: {â€¦}, request: XMLHttpRequest, response: {â€¦}, status: 400, stack: "", â€¦ }
banHangService.js:235:17
ğŸ’° [SHIPPING] API result:
Object { error: true }
ThanhToanDonHang-BanHang.vue:647:13
âš ï¸ [SHIPPING] API khÃ´ng tráº£ vá» phÃ­ há»£p lá»‡ ThanhToanDonHang-BanHang.vue:658:15
Window focused - checking product quantities GioHang.vue:1294:17
ğŸš€ [STOCK UPDATE] Starting batch update for 1 items GioHang.vue:1121:17
Window focused - checking product quantities GioHang.vue:1294:17
â­ï¸ [STOCK UPDATE] Cart is empty, skipping update GioHang.vue:1116:17
Window focused - checking product quantities GioHang.vue:1294:17
ğŸš€ [STOCK UPDATE] Starting batch update for 1 items GioHang.vue:1121:17
ğŸ“Š [BATCH STOCK] Cache: 0 hits, 1 misses batchStockService.js:128:13
ğŸš€ [BATCH API] Fetching stock for 1 products batchStockService.js:137:17
ğŸ“Š [BATCH STOCK] Cache: 0 hits, 1 misses batchStockService.js:128:13
ğŸš€ [BATCH API] Fetching stock for 1 products batchStockService.js:137:17
XHRPOST
http://localhost:8080/gioHangWeb/batchCheckStock
[HTTP/1.1 404  5ms]

XHRPOST
http://localhost:8080/gioHangWeb/batchCheckStock
[HTTP/1.1 404  4ms]

âš ï¸ [BATCH API] Endpoint not found, falling back to parallel calls batchStockService.js:154:21
ğŸ”„ [FALLBACK] Fetching 1 products in parallel batchStockService.js:160:17
âš ï¸ [BATCH API] Endpoint not found, falling back to parallel calls batchStockService.js:154:21
ğŸ”„ [FALLBACK] Fetching 1 products in parallel batchStockService.js:160:17
âœ… [STOCK UPDATE] Received batch data for 1 products GioHang.vue:1137:17
ğŸ“Š [STOCK] Ão thun Cotton: max=46, status=Hoáº¡t Ä‘á»™ng GioHang.vue:1160:21
â„¹ï¸ [STOCK UPDATE] No adjustments needed, all quantities within limits GioHang.vue:1221:21
âœ… [STOCK UPDATE] Received batch data for 1 products GioHang.vue:1137:17
ğŸ“Š [STOCK] Ão thun Cotton: max=46, status=Hoáº¡t Ä‘á»™ng GioHang.vue:1160:21
â„¹ï¸ [STOCK UPDATE] No adjustments needed, all quantities within limits GioHang.vue:1221:21

â€‹
----BE
Láº¥y dá»¯ liá»‡u tá»« database khÃ´ng pháº£i tá»« cache
cháº¡y vÃ o Ä‘Ã¢y
Láº¥y dá»¯ liá»‡u tá»« database khÃ´ng pháº£i tá»« cache
ğŸ” [DEBUG] BanHangWebController.createOrder() - Checking delivery method
  - Delivery method from request: 'ZaloPay'
  - Setting delivery method to: 'ZaloPay'
ğŸ” [DEBUG] BanHangWebController - State after save:
  - Saved Invoice ID: 4091
  - Saved Delivery Method: 'ZaloPay'
  - Saved Order Type: 'Online'
id HoÃ¡ Ä‘Æ¡n: fdfdfd: 4091
=== Táº O ORDER ZALOPAY ===
ID HÃ³a Ä‘Æ¡n: 4091
ğŸ’° Tá»”NG Tá»ª FE: 342000
MÃ£ hÃ³a Ä‘Æ¡n: HDMPGS3P
Tráº¡ng thÃ¡i hiá»‡n táº¡i: Äang chá» thanh toÃ¡n
=== Sá»¬ Dá»¤NG Sá» TIá»€N Tá»ª FE ===
Tá»•ng tá»« FE: 342000
(FE Ä‘Ã£ tÃ­nh: SP + ship - voucher)
=== END ===
>>> Gá»i ZaloPay Create Order API...
ğŸ’° ZALOPAY AMOUNT: 342000 VNÄ
ZaloPay Order Data: {"app_time":1768006152249,"callback_url":"https://fourcha-adolph-noncondescending.ngrok-free.dev /api/zalopay/callback","bank_code":"","amount":342000,"item":"[{\"itemid\":\"H
DMPGS3P\",\"itemname\":\"HÃ³a Ä‘Æ¡n HDMPGS3P\",\"itemprice\":342000,\"itemquantity\":1}]","embed_data":"{\"redirecturl\":\"http://localhost:5173/admin/banhang\",\"merchantinfo\":\"GB Sport - HDMPGS3
P\"}","app_user":"user_1768006152249","description":"Thanh toÃ¡n hÃ³a Ä‘Æ¡n HDMPGS3P","app_id":2554,"app_trans_id":"260110_1768006152248","mac":"033814656f0a0ce259dcf875e3e3c5b3b21e938b9dc6e922b0b79f
8a92f6ac41"}
ZaloPay MAC String: 2554|260110_1768006152248|user_1768006152249|342000|1768006152249|{"redirecturl":"http://localhost:5173/admin/banhang","merchantinfo":"GB Sport - HDMPGS3P"}|[{"itemid":"HDMPGS
3P","itemname":"HÃ³a Ä‘Æ¡n HDMPGS3P","itemprice":342000,"itemquantity":1}]
ZaloPay MAC: 033814656f0a0ce259dcf875e3e3c5b3b21e938b9dc6e922b0b79f8a92f6ac41
ZaloPay Response: {"return_code":1,"return_message":"Giao dá»‹ch thÃ nh cÃ´ng","sub_return_code":1,"sub_return_message":"Giao dá»‹ch thÃ nh cÃ´ng","zp_trans_token":"ACEyueEccqD_cJhYK5jW0AlA","order_url":
"https://qcgateway.zalopay.vn/openinapp?order=eyJ6cHRyYW5zdG9rZW4iOiJBQ0V5dWVFY2NxRF9jSmhZSzVqVzBBbEEiLCJhcHBpZCI6MjU1NH0=","order_token":"ACEyueEccqD_cJhYK5jW0AlA"}
ZaloPay Response Return Code: 1.0
âœ… ÄÃ£ lÆ°u app_trans_id: 260110_1768006152248
=== END Táº O ORDER ===

=== CHECK STATUS DEBUG ===
ID HÃ³a Ä‘Æ¡n: 4091
Tráº¡ng thÃ¡i hiá»‡n táº¡i trong DB: Äang chá» thanh toÃ¡n
Ghi chÃº:  ZaloPay:260110_1768006152248
App Trans ID: 260110_1768006152248
>>> Gá»ŒI ZALOPAY QUERY API...

=== ZALOPAY QUERY ORDER ===
App Trans ID: 260110_1768006152248
Query URL: https://sb-openapi.zalopay.vn/v2/query
Query Params: {"app_id":"2554","app_trans_id":"260110_1768006152248","mac":"3b06117434e9db42a025c927b8d0dfcab6185210606b7b9463525f9f702e8f61"}
=== CHECK STATUS DEBUG ===
ID HÃ³a Ä‘Æ¡n: 4091
Tráº¡ng thÃ¡i hiá»‡n táº¡i trong DB: Äang chá» thanh toÃ¡n
Ghi chÃº:  ZaloPay:260110_1768006152248
App Trans ID: 260110_1768006152248
>>> Gá»ŒI ZALOPAY QUERY API...

=== ZALOPAY QUERY ORDER ===
App Trans ID: 260110_1768006152248
Query URL: https://sb-openapi.zalopay.vn/v2/query
Query Params: {"app_id":"2554","app_trans_id":"260110_1768006152248","mac":"3b06117434e9db42a025c927b8d0dfcab6185210606b7b9463525f9f702e8f61"}
ZaloPay Query Response: {"return_code":3,"return_message":"Giao dá»‹ch chÆ°a Ä‘Æ°á»£c thá»±c hiá»‡n","sub_return_code":0,"sub_return_message":"Giao dá»‹ch chÆ°a Ä‘Æ°á»£c thá»±c hiá»‡n","is_processing":true,"amount":0,
"zp_trans_id":0,"discount_amount":0}
Parsed Return Code: 3.0
Parsed Return Message: Giao dá»‹ch chÆ°a Ä‘Æ°á»£c thá»±c hiá»‡n
=== END ZALOPAY QUERY ===

ZaloPay Response Return Code: 3.0
ZaloPay Response Message: Giao dá»‹ch chÆ°a Ä‘Æ°á»£c thá»±c hiá»‡n
>>> CHÆ¯A THANH TOÃN - Return Code: 3.0
=== END CHECK STATUS ===

ZaloPay Query Response: {"return_code":3,"return_message":"Giao dá»‹ch chÆ°a Ä‘Æ°á»£c thá»±c hiá»‡n","sub_return_code":0,"sub_return_message":"Giao dá»‹ch chÆ°a Ä‘Æ°á»£c thá»±c hiá»‡n","is_processing":true,"amount":0,
"zp_trans_id":0,"discount_amount":0}
Parsed Return Code: 3.0
Parsed Return Message: Giao dá»‹ch chÆ°a Ä‘Æ°á»£c thá»±c hiá»‡n
=== END ZALOPAY QUERY ===

ZaloPay Response Return Code: 3.0
ZaloPay Response Message: Giao dá»‹ch chÆ°a Ä‘Æ°á»£c thá»±c hiá»‡n
>>> CHÆ¯A THANH TOÃN - Return Code: 3.0
=== END CHECK STATUS ===

=== CHECK STATUS DEBUG ===
ID HÃ³a Ä‘Æ¡n: 4091
Tráº¡ng thÃ¡i hiá»‡n táº¡i trong DB: Äang chá» thanh toÃ¡n
Ghi chÃº:  ZaloPay:260110_1768006152248
App Trans ID: 260110_1768006152248
>>> Gá»ŒI ZALOPAY QUERY API...

=== ZALOPAY QUERY ORDER ===
App Trans ID: 260110_1768006152248
Query URL: https://sb-openapi.zalopay.vn/v2/query
Query Params: {"app_id":"2554","app_trans_id":"260110_1768006152248","mac":"3b06117434e9db42a025c927b8d0dfcab6185210606b7b9463525f9f702e8f61"}
=== CHECK STATUS DEBUG ===
ID HÃ³a Ä‘Æ¡n: 4091
Tráº¡ng thÃ¡i hiá»‡n táº¡i trong DB: Äang chá» thanh toÃ¡n
Ghi chÃº:  ZaloPay:260110_1768006152248
App Trans ID: 260110_1768006152248
>>> Gá»ŒI ZALOPAY QUERY API...

=== ZALOPAY QUERY ORDER ===
App Trans ID: 260110_1768006152248
Query URL: https://sb-openapi.zalopay.vn/v2/query
Query Params: {"app_id":"2554","app_trans_id":"260110_1768006152248","mac":"3b06117434e9db42a025c927b8d0dfcab6185210606b7b9463525f9f702e8f61"}
ZaloPay Query Response: {"return_code":1,"return_message":"Giao dá»‹ch thÃ nh cÃ´ng","sub_return_code":1,"sub_return_message":"Giao dá»‹ch thÃ nh cÃ´ng","is_processing":false,"amount":342000,"zp_trans_id
":260110000000130,"server_time":1768006181685,"discount_amount":0}
ZaloPay Query Response: {"return_code":1,"return_message":"Giao dá»‹ch thÃ nh cÃ´ng","sub_return_code":1,"sub_return_message":"Giao dá»‹ch thÃ nh cÃ´ng","is_processing":false,"amount":342000,"zp_trans_id
":260110000000130,"server_time":1768006181685,"discount_amount":0}
Parsed Return Code: 1.0
Parsed Return Message: Giao dá»‹ch thÃ nh cÃ´ng
=== END ZALOPAY QUERY ===

Parsed Return Code: 1.0
Parsed Return Message: Giao dá»‹ch thÃ nh cÃ´ng
=== END ZALOPAY QUERY ===

ZaloPay Response Return Code: 1.0
ZaloPay Response Message: Giao dá»‹ch thÃ nh cÃ´ng
>>> ZALOPAY XÃC NHáº¬N THÃ€NH CÃ”NG - Cáº¬P NHáº¬T DB
ZaloPay Response Return Code: 1.0
ZaloPay Response Message: Giao dá»‹ch thÃ nh cÃ´ng
>>> ZALOPAY XÃC NHáº¬N THÃ€NH CÃ”NG - Cáº¬P NHáº¬T DB
=== END CHECK STATUS ===

=== END CHECK STATUS ===

âœ… ÄÃ£ táº¡o theo dÃµi Ä‘Æ¡n hÃ ng: ÄÃ£ xÃ¡c nháº­n
âœ… ÄÃ£ táº¡o theo dÃµi Ä‘Æ¡n hÃ ng: ÄÃ£ xÃ¡c nháº­n
ğŸ” [DEBUG] BanHangWebController - Checking delivery method
ğŸ” [DEBUG] BanHangWebController - Checking delivery method
  - Delivery method from request: 'Giao hÃ ng'
  - Delivery method from request: 'Giao hÃ ng'
  - Setting delivery method to: 'Giao hÃ ng'
  - Setting delivery method to: 'Giao hÃ ng'
ğŸ” [DEBUG] BanHangWebController.suaHoaDon() - State after save:
  - Saved Invoice ID: 4091
  - Saved Delivery Method: 'Giao hÃ ng'
  - Saved Order Type: 'Online'
ğŸ” [DEBUG] BanHangWebController.suaHoaDon() - State after save:
  - Saved Invoice ID: 4091
  - Saved Delivery Method: 'Giao hÃ ng'
  - Saved Order Type: 'Online'
â­ï¸ Skipped duplicate tracking - already confirmed by callback






